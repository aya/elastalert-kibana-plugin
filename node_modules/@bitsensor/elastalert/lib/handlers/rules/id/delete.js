'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = ruleDeleteHandler;

var _route_logger = require('src/routes/route_logger');

var _route_logger2 = _interopRequireDefault(_route_logger);

var _utils = require('src/common/errors/utils');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var logger = new _route_logger2.default('/rules/:id', 'DELETE');

function ruleDeleteHandler(request, result) {
  /**
   * @type {ElastalertServer}
   */
  var server = request.app.get('server');

  server.rulesController.rule(request.params.id).then(function (rule) {
    rule.delete().then(function (rule) {
      result.send(rule);
      logger.sendSuccessful({
        deleted: true,
        id: request.params.id
      });
    }).catch(function (error) {
      (0, _utils.sendRequestError)(request, error);
      logger.sendFailed(error);
    });
  }).catch(function (error) {
    (0, _utils.sendRequestError)(request, error);
  });
}